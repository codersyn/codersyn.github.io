---
title: 泰拉瑞亚修改教程
date: 2021-10-03 07:44:44
tags:
typora-root-url: ./
---

> 一个关于泰拉瑞亚的简单修改教程，因为视频教程说有看不懂的地方，这里再做一个文字版本。

### 环境及版本

+ 当前游戏版本 v1.4.2.3
+ .NET Framework 4.8 ([官网下载](https://dotnet.microsoft.com/download/dotnet-framework/thank-you/net48-web-installer))
+ CheatEngine 7.3 ([官网下载](https://cheatengine.org/))

### 第一章 — Player地址的获取方法

+ ~~第一步，删掉同志短剑~~，#滑稽

+ 第一步，进入游戏，打开CE，进程选择附加到Terraria，搜索血值和魔法值的组合地址：
  
  ![image-20211003081103842](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003081103842.png)
  
  *注*：Value Type选择Grouped，然后在上面输入框内输入`4:100 4:100 4:100 4:20 4:20`，此处的100和20分别代表你的血值和魔法值，如你不是新角色，请自行更改为你当前的血值和魔法值，譬如你当前的角色血量为500，魔法值为200那就更改为`4:500 4:500 4:500 4:200 4:200`注意每组值之间有空格，然后点击First Scan。

+ 第二步，开始搜索内存地址：
  
  ![image-20211003091756165](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003091756165.png)
  
  *注*：图上的内存地址每个人都不相同，因为它是动态变化的，不必因为和我的不同而产生自己错了的错觉。

+ 第三步，选中第三个血值地址，右键查看是什么访问了它：
  
  ![image-20211003092657177](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003092657177.png)

+ 第四步，返回游戏，触发一下内存地址的刷新，再返回CE，选择最后一个地址：
  
  ![image-20211003100323003](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003100323003.png)
  
  *注*：务必先返回游戏触发一下，否则不会出现这个地址。地址不一定在最后一个，只要寄存器是`ebx`就行，选中该地址，然后点击右边的Show disassembler。

+ 第五步，在弹出的页面复制动态地址的模块地址：
  
  ![image-20211003101129902](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003101129902.png)

+ 第六步，点击Tools，选择：Auto Assemble：
  
  ![image-20211003101311839](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003101311839.png)

+ 第七步，选择Template，选择Full Injection：
  
  ![image-20211003101825161](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003101825161.png)

+ 第八步，粘贴刚才复制的模块地址，然后点击OK进入编辑界面：
  
  ![image-20211003102056277](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003102056277.png)

+ 第九步，添加人造指针，此处直接贴出代码，自己按需修改：
  
  ```javascript
  define(address,Terraria.Player::UpdateLifeRegen+BE9)  // 这里如果不同请替换为你的地址
  define(bytes,8B 83 D8 03 00 00)  // 同上
  
  [ENABLE]
  
  assert(address,bytes)
  alloc(newmem,$1000)
  alloc(syn,4)  // 为syn分配内存，syn可换为任意你喜欢的，下同
  registersymbol(syn)  // 注册全局名称syn
  
  label(code)
  label(return)
  
  newmem:
  
  code:
    mov [syn],ebx  // 移动寄存器ebx里的地址到syn里
    mov eax,[ebx+000003D8]
    jmp return
  
  address:
    jmp newmem
    nop
  return:
  
  [DISABLE]
  
  address:
    db bytes
    // mov eax,[ebx+000003D8]
  
  dealloc(newmem)
  dealloc(syn)  // 释放syn的内存
  unregistersymbol(syn)  // 取消syn的注册
  ```

  *注*：有添加代码的地方都做了注释，你可以手动在编辑框内输入在对应的位置，也可直接复制粘贴到你的编辑框，注意如果地址不同请以你自己的地址为准，不要覆盖了。编辑完成后点击左上角的File，然后点击Assign to current cheat table，这样就把脚本添加到了CE的主界面。

  ![image-20211003104829820](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003104829820.png)

+ 第十步，回到CE主界面，其他多余的窗口都可关掉，点击右边的Add Address Manually添加地址，在框内输入`syn`，并勾选下面的Hexadecimal，最后点击OK保存。
  
  ![image-20211003105507769](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003105507769.png)

+ 第十一步，勾选Auto Assemble script，并复制刚才添加的syn的地址，然后点击Memory View：
  
  ![image-20211003113940196](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003113940196.png)
  
  *注*：如果此步你的地址为000000，那返回游戏随便动一下就会有地址了。

+ 第十二步，点击Memory View后来到这个页面，点击Tools，再点击Dissect data/structures：
  
  ![image-20211003114504860](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003114504860.png)

+ 第十三步，在输入框内粘贴刚才复制的地址，点击Structures，点击Define new structure：
  
  ![image-20211003114823162](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003114823162.png)
  
  并在弹出的窗口点击OK：
  
  ![image-20211003115148994](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003115148994.png)
  
  *注*：此处输入框内自动显示的应是`Terraria.Player`才为正确，显示其他皆为错。

+ 第十四步，根据英文描述修改自己想修改的东西即可：
  
  ![image-20211003120351936](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003120351936.png)
  
  下面贴出一些常用修改项：
  
  ```
  statLifeMax--生命值上限
  statLife--当前生命值
  statManaMax--魔法值上限
  statMana--当前魔法值
  breath--当前氧气值（配合锁定可达到无限氧气）
  buffType--buff类型（需配合buff时间使用）
  buffTime--buff持续时间
  inventory--Array[0]--物品栏第一个格子
  下面的项目都是在物品栏第一个格子下：
  fishingPole--渔力
  bait--鱼饵力
  useAnimation--挥动速度
  stack--数量
  maxStack--最大数量
  pick--镐力
  axe--斧力
  hammer--锤力
  damage--伤害
  knockBack--击退力
  healLife--回复生命
  healMana--回复魔法
  scale--大小
  defense--防御力
  shoot--弹幕
  useTime--弹幕数量（值越小越多）
  shootSpeed--弹幕飞行速度
  netID--物品ID（修改后需返回到主菜单重进可生效）
  ```

  到这里你基本能做到游戏内的大部分修改，但是某些特殊的功能无法做到（如无限召唤，一击必杀，地图高亮，物品全制作，时间加速等等），这些后续会慢慢讲到。现在的问题是你的修改目前是一次性的，如果退出了游戏就会导致无法再修改，因为目前的地址都是动态地址，重启游戏就会变动，所以我们需要把这些地址改为syn+偏移的形式，这样就算重启也不会失效。

+ 第十五步，把动态地址改为指针地址，比如我想修改当前生命值：
  
  ![image-20211003134408896](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003134408896.png)
  
  然后回到CE地址列表：
  
  ![image-20211003134858113](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211003134858113.png)
  
  *注*：你可能会想问为什么偏移是3d8，因为![1633559546(1)](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/1633559546(1).png)，仔细看英文描述前面的对应的就是这个地址的偏移。
  
  再比如我想修改镐子的攻击力，那就把镐子放到物品栏第一个格子：
  
  ![image-20211004143026141](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/image-20211004143026141.png)
  
  然后在CE里定位到![1633558673(1)](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/1633558673(1).png)， 同样选中damage，按A键添加到地址列表，双击后把它修改为指针地址：
  
  ![1633330269(1)](/../images/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B/1633330269(1).png)
  
  *注*：此处可看到damage的偏移为三级偏移，分别为D0，8，D4，那改为指针地址的时候就不能只添加D4，需要三个偏移都添加进去，如上图所示，需要注意的是多级指针的添加顺序是由下至上的。

+ 最后，总结一下，看似步骤很多，其实也就两三分钟的事情，某些步骤完全就是一个操作拆分为几个步骤来讲，可谓真·保姆教程。简单来说就是搜索血值动态地址，根据动态地址的模块地址来编写脚本，实时获取到player动态地址，再根据player地址+偏移得到自己想修改的项。哦对了，最后一定别忘记保存你的地址列表为CT文件，别辛苦一番忘记保存了下次重新修改又得重新找地址。到这里第一章关于player地址的获取教程就结束了，下一章应该会写一些关于某些无法直接修改的项如何用脚本达到修改的目的，或者写如何用CE直接生成可直接运行的exe程序，再说吧。

### 第二章—利用脚本达到复杂的功能

[第二章传送门](https://synblog.gq/2022/02/17/%E6%B3%B0%E6%8B%89%E7%91%9E%E4%BA%9A%E4%BF%AE%E6%94%B9%E6%95%99%E7%A8%8B-%E8%84%9A%E6%9C%AC%E7%AF%87/)


